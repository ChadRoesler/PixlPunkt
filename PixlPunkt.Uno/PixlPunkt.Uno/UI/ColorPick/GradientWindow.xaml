<!--
═══════════════════════════════════════════════════════════════════════════════
  GRADIENT WINDOW - Gradient Color Palette Generator
═══════════════════════════════════════════════════════════════════════════════
  Creates multi-step color gradients with customizable falloff curves for
  palette generation.
  
  Layout Structure:
    Left Column:  HSL saturation/lightness square + hue bar
    Right Column: Value inputs + Triangle curve editor + Preview
  
  Features:
    • Dual color picker (Start/End colors)
    • HSL canvas for saturation/lightness picking (240x240)
    • Hue bar for hue selection (240x18)
    • Start/End color chip selector with visual indicators
    • Swap button to exchange start ↔ end colors
    • Triangle curve editor for non-linear falloff control
    • Step count configuration (3-32 swatches)
    • Live preview with wrapped swatch display (8 columns max)
    • Hex color input (RGB only, no alpha)
    • HSL and RGB number box inputs
    • Global color dropper button for picking from canvas
═══════════════════════════════════════════════════════════════════════════════
-->
<Window
    x:Class="PixlPunkt.Uno.UI.ColorPick.GradientWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:conv="using:PixlPunkt.Uno.UI.Converters"
    xmlns:curv="using:PixlPunkt.Uno.UI.ColorPick.Controls"
    xmlns:ctrl="using:PixlPunkt.Uno.UI.Controls"
    xmlns:ic="using:FluentIcons.WinUI">

    <Grid 
        Background="{ThemeResource SolidBackgroundFillColorBaseBrush}" 
        Padding="12,6,20,12" 
        RowSpacing="8">

        <!-- ═══════════════════════════════════════════════════════════════ -->
        <!-- RESOURCES -->
        <!-- ═══════════════════════════════════════════════════════════════ -->
        <Grid.Resources>

            <!-- Horizontal layout template for preview swatches -->
            <ItemsPanelTemplate x:Key="HorizPanel">
                <ItemsStackPanel Orientation="Horizontal"/>
            </ItemsPanelTemplate>

            <!-- Converts BGRA uint to WinUI Brush for swatch display -->
            <conv:BgraToBrushConverter x:Key="BgraToBrush"/>

            <!-- Converts bool to Visibility -->
            <conv:BoolToVisibilityConverter x:Key="BoolToVis"/>

            <!-- ─────────────────────────────────────────────────────────── -->
            <!-- SWATCH PREVIEW TEMPLATE -->
            <!-- ─────────────────────────────────────────────────────────── -->
            <DataTemplate x:Key="SwatchTemplate">
                <Border 
                    Width="32" 
                    Height="26" 
                    Margin="1" 
                    CornerRadius="5"
                    BorderThickness="1" 
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    Background="{Binding Converter={StaticResource BgraToBrush}}"/>
            </DataTemplate>

            <!-- ─────────────────────────────────────────────────────────── -->
            <!-- COMPACT CONTROL STYLES -->
            <!-- ─────────────────────────────────────────────────────────── -->

            <!-- Number Box: Uniform sizing for HSL/RGB inputs -->
            <Style TargetType="NumberBox">
                <Setter Property="MinWidth" Value="84"/>
                <Setter Property="Height" Value="32"/>
                <Setter Property="CornerRadius" Value="6"/>
                <Setter Property="Padding" Value="8,6"/>
            </Style>

            <!-- Text Box: Hex color input styling -->
            <Style TargetType="TextBox">
                <Setter Property="MinWidth" Value="220"/>
                <Setter Property="CornerRadius" Value="6"/>
                <Setter Property="Padding" Value="8,6"/>
            </Style>

            <!-- Slider: Compact height -->
            <Style TargetType="Slider">
                <Setter Property="Height" Value="20"/>
            </Style>

        </Grid.Resources>

        <!-- ═══════════════════════════════════════════════════════════════ -->
        <!-- GRID LAYOUT DEFINITION -->
        <!-- Row 0: Main content | Row 1: Footer buttons -->
        <!-- ═══════════════════════════════════════════════════════════════ -->
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Main content row -->
            <RowDefinition Height="Auto"/>
            <!-- Footer button row -->
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <!-- Left: HSL canvases -->
            <ColumnDefinition Width="16"/>
            <!-- Spacing gap -->
            <ColumnDefinition Width="*"/>
            <!-- Right: Values + preview -->
        </Grid.ColumnDefinitions>

        <!-- ═══════════════════════════════════════════════════════════════ -->
        <!-- LEFT COLUMN: HSL CANVASES -->
        <!-- Interactive color selection for start/end colors -->
        <!-- ═══════════════════════════════════════════════════════════════ -->
        <!-- Replace the entire LEFT COLUMN stackpanel with this block -->
        <StackPanel 
    Grid.Row="0" 
    Grid.Column="0" 
    Spacing="8">

            <!-- Reusable HSL square -->
            <curv:HslSquare x:Name="HslSquare"
                    Width="240"
                    Height="240"
                    SVChanging="HslSquare_SVChanging"
                    SVChanged="HslSquare_SVChanged"/>

            <!-- Reusable hue slider -->
            <curv:HueSlider x:Name="HueSlider"
                    Width="240"
                    Height="18"
                    HueChanging="HueSlider_HueChanging"
                    HueChanged="HueSlider_HueChanged"/>
        </StackPanel>

        <!-- ═══════════════════════════════════════════════════════════════ -->
        <!-- RIGHT COLUMN: CONTROLS & PREVIEW -->
        <!-- Two-column layout: input controls + curve/preview -->
        <!-- ═══════════════════════════════════════════════════════════════ -->
        <Grid 
            Grid.Row="0" 
            Grid.Column="2" 
            ColumnSpacing="16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="260"/>
                <!-- Values column -->
                <ColumnDefinition Width="*"/>
                <!-- Curve + preview column -->
            </Grid.ColumnDefinitions>

            <!-- ─────────────────────────────────────────────────────────── -->
            <!-- VALUES COLUMN: Start/End Selection & Input Controls -->
            <!-- ─────────────────────────────────────────────────────────── -->
            <StackPanel 
                Grid.Column="0" 
                Spacing="8">

                <!-- Start/End Color Chip Selector with Dropper Button -->
                <StackPanel 
                    Orientation="Horizontal" 
                    Spacing="10">

                    <!-- Start Color Section -->
                    <TextBlock 
                        Text="Start" 
                        VerticalAlignment="Center" 
                        Opacity="0.7"/>

                    <!-- Start Color Chip (click to select for editing) -->
                    <Grid 
                        x:Name="StartChipRoot" 
                        Tapped="StartChip_Tapped">
                        <Border 
                            x:Name="StartChip" 
                            Width="44" 
                            Height="24" 
                            CornerRadius="6"
                            Background="{Binding StartBrush}"/>

                        <!-- Selection Ring (visible when editing start) -->
                        <Border 
                            Width="44" 
                            Height="24" 
                            CornerRadius="6"
                            BorderThickness="2"
                            BorderBrush="{ThemeResource AccentFillColorDefaultBrush}"
                            Visibility="{Binding IsEditingStart, Converter={StaticResource BoolToVis}}"/>
                    </Grid>

                    <!-- End Color Section -->
                    <TextBlock 
                        Text="End" 
                        VerticalAlignment="Center" 
                        Opacity="0.7"/>

                    <!-- End Color Chip (click to select for editing) -->
                    <Grid 
                        x:Name="EndChipRoot" 
                        Tapped="EndChip_Tapped">
                        <Border 
                            x:Name="EndChip" 
                            Width="44" 
                            Height="24" 
                            CornerRadius="6"
                            Background="{Binding EndBrush}"/>

                        <!-- Selection Ring (visible when editing end) -->
                        <Border 
                            Width="44" 
                            Height="24" 
                            CornerRadius="6"
                            BorderThickness="2"
                            BorderBrush="{ThemeResource AccentFillColorDefaultBrush}"
                            Visibility="{Binding IsEditingEnd, Converter={StaticResource BoolToVis}}"/>
                    </Grid>

                    <!-- Swap Start ↔ End Button -->
                    <Button 
                        Click="Swap_Click" >
                        <ic:FluentIcon Icon="ArrowSwap" FontSize="16"/>
                    </Button>

                    <!-- Global Color Dropper Button -->
                    <ToggleButton 
                        x:Name="DropperButton"
                        Padding="6"
                        ToolTipService.ToolTip="Pick color from canvas (sets selected Start or End color)"
                        Checked="DropperButton_Checked"
                        Unchecked="DropperButton_Unchecked">
                        <ic:FluentIcon Icon="Syringe" FontSize="16"/>
                    </ToggleButton>
                </StackPanel>

                <!-- HSL & RGB Input Grid (3x5 layout, no alpha) -->
                <Grid 
                    ColumnSpacing="8" 
                    RowSpacing="6">
                    <Grid.RowDefinitions>
                        <RowDefinition/>
                        <!-- H / R -->
                        <RowDefinition/>
                        <!-- S / G -->
                        <RowDefinition/>
                        <!-- L / B -->
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <!-- HSL label -->
                        <ColumnDefinition Width="*"/>
                        <!-- HSL value -->
                        <ColumnDefinition Width="8"/>
                        <!-- Gap -->
                        <ColumnDefinition Width="Auto"/>
                        <!-- RGB label -->
                        <ColumnDefinition Width="*"/>
                        <!-- RGB value -->
                    </Grid.ColumnDefinitions>

                    <!-- Row 0: Hue (0-359) / Red (0-255) -->
                    <TextBlock 
                        Text="H" 
                        Grid.Row="0" 
                        Grid.Column="0" 
                        VerticalAlignment="Center"/>
                    <NumberBox 
                        x:Name="HBox" 
                        Grid.Row="0" 
                        Grid.Column="1" 
                        Minimum="0" 
                        Maximum="359"
                        SmallChange="1" 
                        ValueChanged="HBox_ValueChanged"/>

                    <TextBlock 
                        Text="R" 
                        Grid.Row="0" 
                        Grid.Column="3" 
                        VerticalAlignment="Center"/>
                    <NumberBox 
                        x:Name="RBox" 
                        Grid.Row="0" 
                        Grid.Column="4" 
                        Minimum="0" 
                        Maximum="255"
                        ValueChanged="RBox_ValueChanged"/>

                    <!-- Row 1: Saturation (0-99) / Green (0-255) -->
                    <TextBlock 
                        Text="S" 
                        Grid.Row="1" 
                        Grid.Column="0" 
                        VerticalAlignment="Center"/>
                    <NumberBox 
                        x:Name="SBoxInt" 
                        Grid.Row="1" 
                        Grid.Column="1" 
                        Minimum="0" 
                        Maximum="99"
                        ValueChanged="SBoxInt_ValueChanged"/>

                    <TextBlock 
                        Text="G" 
                        Grid.Row="1" 
                        Grid.Column="3" 
                        VerticalAlignment="Center"/>
                    <NumberBox 
                        x:Name="GBox" 
                        Grid.Row="1" 
                        Grid.Column="4" 
                        Minimum="0" 
                        Maximum="255"
                        ValueChanged="GBox_ValueChanged"/>

                    <!-- Row 2: Lightness (0-99) / Blue (0-255) -->
                    <TextBlock 
                        Text="L" 
                        Grid.Row="2" 
                        Grid.Column="0" 
                        VerticalAlignment="Center"/>
                    <NumberBox 
                        x:Name="LBoxInt" 
                        Grid.Row="2" 
                        Grid.Column="1" 
                        Minimum="0" 
                        Maximum="99"
                        ValueChanged="LBoxInt_ValueChanged"/>

                    <TextBlock 
                        Text="B" 
                        Grid.Row="2" 
                        Grid.Column="3" 
                        VerticalAlignment="Center"/>
                    <NumberBox 
                        x:Name="BBox" 
                        Grid.Row="2" 
                        Grid.Column="4" 
                        Minimum="0" 
                        Maximum="255"
                        ValueChanged="BBox_ValueChanged"/>
                </Grid>

                <!-- Step Count Configuration -->
                <Grid 
                    ColumnSpacing="8" 
                    Margin="0,8,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock 
                        Text="Steps (3 - 32)" 
                        VerticalAlignment="Center"/>
                    <NumberBox 
                        x:Name="StepsBox" 
                        Grid.Column="1" 
                        Minimum="3" 
                        Maximum="32" 
                        Value="8"
                        ValueChanged="StepsBox_ValueChanged"/>
                </Grid>

                <!-- Hex Color Input (RGB only, no alpha) -->
                <TextBlock 
                    Text="Hex (#RRGGBB or #AARRGGBB)" 
                    Margin="0,10,0,0"/>
                <TextBox 
                    x:Name="HexBox" 
                    TextChanged="HexBox_TextChanged"/>
            </StackPanel>

            <!-- ─────────────────────────────────────────────────────────── -->
            <!-- CURVE EDITOR & PREVIEW COLUMN -->
            <!-- Triangle falloff curve + gradient preview -->
            <!-- ─────────────────────────────────────────────────────────── -->
            <Grid Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <!-- Falloff title -->
                    <RowDefinition Height="Auto"/>
                    <!-- Curve editor -->
                    <RowDefinition Height="Auto"/>
                    <!-- Preview title -->
                    <RowDefinition Height="*"/>
                    <!-- Preview swatches -->
                </Grid.RowDefinitions>

                <!-- Falloff Curve Section Title -->
                <TextBlock 
                    Grid.Row="0" 
                    Text="Fall Off" 
                    Margin="0,0,0,4"/>

                <!-- Triangle Curve Editor (Interactive Bezier Control) -->
                <curv:TriangleCurveEditor 
                    x:Name="TriFalloff"
                    Grid.Row="1" 
                    Height="140" 
                    Margin="0,0,0,8"/>

                <!-- Preview Section Title -->
                <TextBlock 
                    Grid.Row="2" 
                    Text="Preview" 
                    Margin="0,0,0,4"/>

                <!-- Gradient Preview (Wrapped Swatch Grid) -->
                <Border 
                    Grid.Row="3"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="6"
                    MinHeight="127">

                    <ItemsControl 
                        ItemsSource="{Binding PreviewItems}"
                        ItemTemplate="{StaticResource SwatchTemplate}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <!-- Use custom WrapPanel for Uno Platform compatibility -->
                                <!-- WrapGrid and ItemsWrapGrid are not supported in Uno Platform Skia -->
                                <ctrl:WrapPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                    </ItemsControl>
                </Border>
            </Grid>
        </Grid>

        <!-- ═══════════════════════════════════════════════════════════════ -->
        <!-- FOOTER: Action Buttons -->
        <!-- ═══════════════════════════════════════════════════════════════ -->
        <StackPanel 
            Grid.Row="1" 
            Grid.ColumnSpan="3"
            Orientation="Horizontal" 
            HorizontalAlignment="Right" 
            Spacing="8">
            <Button 
                Content="Add to Palette" 
                Click="AddToPalette_Click"/>
            <Button 
                Content="Close" 
                Click="Close_Click"/>
        </StackPanel>

    </Grid>
</Window>
