<UserControl
    x:Class="PixlPunkt.Uno.UI.Settings.ShortcutSettingsPanel"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:PixlPunkt.Uno.UI.Settings"
    xmlns:ic="using:FluentIcons.WinUI">

	<StackPanel Spacing="16">
		<TextBlock Text="Keyboard Shortcuts" FontSize="20" FontWeight="SemiBold"/>

		<!-- Conflict Warning Banner -->
		<Border x:Name="ConflictWarningBanner"
                Background="{ThemeResource SystemFillColorCautionBackgroundBrush}"
                CornerRadius="8"
                Padding="16"
                Visibility="Collapsed">
			<StackPanel Spacing="8">
				<StackPanel Orientation="Horizontal" Spacing="8">
					<ic:FluentIcon Icon="Warning" Foreground="{ThemeResource SystemFillColorCautionBrush}" FontSize="20"/>
					<TextBlock Text="Shortcut Conflicts Detected" FontWeight="SemiBold" Foreground="{ThemeResource SystemFillColorCautionBrush}" VerticalAlignment="Center"/>
				</StackPanel>
				<TextBlock x:Name="ConflictDetailsText"
                           Text="Multiple tools share the same keyboard shortcut."
                           TextWrapping="Wrap"
                           Opacity="0.9"/>
				<StackPanel Orientation="Horizontal" Spacing="8" Margin="0,8,0,0">
					<Button x:Name="ViewConflictsBtn" Content="View Conflicts" Click="ViewConflictsBtn_Click"/>
					<Button x:Name="DismissConflictsBtn" Content="Dismiss" Click="DismissConflictsBtn_Click"/>
				</StackPanel>
			</StackPanel>
		</Border>

		<!-- Options -->
		<Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
				BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
				BorderThickness="1"
				CornerRadius="8" Padding="16">
			<StackPanel Spacing="12">
				<TextBlock Text="Options" FontWeight="SemiBold" FontSize="14"/>

				<CheckBox x:Name="ShowConflictWarningsCheck"
                          Content="Show shortcut conflict warnings on startup"
                          IsChecked="True"/>

				<StackPanel Orientation="Horizontal" Spacing="8">
					<Button x:Name="ResetAllBtn" Content="Reset All to Defaults" Click="ResetAllBtn_Click"/>
				</StackPanel>
			</StackPanel>
		</Border>

		<!-- Tool Shortcuts List -->
		<Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
				BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
				BorderThickness="1"
				CornerRadius="8" Padding="16">
			<StackPanel Spacing="12">
				<StackPanel Orientation="Horizontal" Spacing="12">
					<TextBlock Text="Tool Shortcuts" FontWeight="SemiBold" FontSize="14" VerticalAlignment="Center"/>
					<TextBlock x:Name="ShortcutCountText" Text="0 shortcuts" Opacity="0.6" VerticalAlignment="Center"/>
				</StackPanel>

				<!-- Category Filter -->
				<StackPanel Orientation="Horizontal" Spacing="8">
					<TextBlock Text="Filter:" VerticalAlignment="Center" Opacity="0.8"/>
					<ComboBox x:Name="CategoryFilter" Width="150" SelectionChanged="CategoryFilter_SelectionChanged">
						<ComboBoxItem Content="All Tools" IsSelected="True"/>
						<ComboBoxItem Content="Brush Tools"/>
						<ComboBoxItem Content="Selection Tools"/>
						<ComboBoxItem Content="Shape Tools"/>
						<ComboBoxItem Content="Utility Tools"/>
						<ComboBoxItem Content="Tile Tools"/>
						<ComboBoxItem Content="Plugin Tools"/>
					</ComboBox>

					<TextBox x:Name="SearchBox"
							 PlaceholderText="Search tools..."
							 Width="300"
							 HorizontalAlignment="Left"
							 TextChanged="SearchBox_TextChanged"/>
				</StackPanel>

				<ListView x:Name="ShortcutListView"
						  MaxHeight="400"
						  Margin="0,12,0,0"
						  SelectionMode="Single"
						  Background="{ThemeResource LayerFillColorDefaultBrush}"
						  BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
						  BorderThickness="1"
						  CornerRadius="4">
					<ListView.ItemTemplate>
						<DataTemplate x:DataType="local:ShortcutListItem">
							<Grid Padding="12,8" ColumnDefinitions="Auto, *, Auto, Auto">
								<!-- Icon -->
								<ic:FluentIcon Grid.Column="0"
											   Icon="{Binding Icon}"
											   FontSize="20"
											   Margin="0,0,12,0"
											   VerticalAlignment="Center"/>

								<!-- Tool Name & Category -->
								<StackPanel Grid.Column="1" VerticalAlignment="Center">
									<StackPanel Orientation="Horizontal" Spacing="8">
										<TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold"/>
										<Border x:Name="ConflictBadge"
												Background="{ThemeResource SystemFillColorCriticalBackgroundBrush}"
												CornerRadius="4"
												Padding="6,2"
												Visibility="{Binding HasConflict}">
											<TextBlock Text="Conflict" FontSize="10" Foreground="{ThemeResource SystemFillColorCriticalBrush}"/>
										</Border>
										<Border x:Name="CustomBadge"
												Background="{ThemeResource SystemFillColorAttentionBackgroundBrush}"
												CornerRadius="4"
												Padding="6,2"
												Visibility="{Binding IsCustomized}">
											<TextBlock Text="Custom" FontSize="10" Foreground="{ThemeResource SystemFillColorAttentionBrush}"/>
										</Border>
									</StackPanel>
									<TextBlock Text="{Binding CategoryDisplay}" Opacity="0.5" FontSize="11"/>
								</StackPanel>

								<!-- Current Shortcut -->
								<Border Grid.Column="2"
										Background="{ThemeResource ControlFillColorDefaultBrush}"
										CornerRadius="4"
										Padding="12,6"
										Margin="0,0,8,0"
										MinWidth="80"
										VerticalAlignment="Center">
									<TextBlock Text="{Binding ShortcutDisplay}"
											   HorizontalAlignment="Center"
											   FontFamily="Consolas"
											   FontSize="12"/>
								</Border>

								<!-- Edit Button -->
								<Button Grid.Column="3"
										Content="Edit"
										Click="EditShortcut_Click"
										Tag="{Binding ToolId}"
										VerticalAlignment="Center"/>
							</Grid>
						</DataTemplate>
					</ListView.ItemTemplate>
				</ListView>
			</StackPanel>
		</Border>

		<!-- Instructions -->
		<Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
				BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
				BorderThickness="1"
				CornerRadius="8" Padding="16">
			<StackPanel Spacing="6">
				<TextBlock Text="Tips" FontWeight="SemiBold" FontSize="14"/>
				<TextBlock Text="• Click 'Edit' to change a tool's keyboard shortcut" Opacity="0.6" FontSize="12"/>
				<TextBlock Text="• Press Escape in the edit dialog to cancel" Opacity="0.6" FontSize="12"/>
				<TextBlock Text="• Press Backspace/Delete to clear a shortcut" Opacity="0.6" FontSize="12"/>
				<TextBlock Text="• Conflicts are highlighted in red - only the first matching tool will activate" Opacity="0.6" FontSize="12"/>
			</StackPanel>
		</Border>
	</StackPanel>
</UserControl>
