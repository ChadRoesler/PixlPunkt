using System;
using System.Numerics;
using Windows.Foundation;
using Windows.UI;

namespace PixlPunkt.Uno.Core.Rendering;

/// <summary>
/// Platform-agnostic canvas rendering interface.
/// Abstracts SkiaSharp drawing operations for cross-platform rendering.
/// </summary>
public interface ICanvasRenderer : IDisposable
{
    /// <summary>
    /// Gets the underlying device/context for creating resources.
    /// </summary>
    object Device { get; }

    /// <summary>
    /// Gets the width of the render target.
    /// </summary>
    float Width { get; }

    /// <summary>
    /// Gets the height of the render target.
    /// </summary>
    float Height { get; }

    /// <summary>
    /// Clears the canvas with the specified color.
    /// </summary>
    void Clear(Color color);

    // ????????????????????????????????????????????????????????????????????
    // LINE DRAWING
    // ????????????????????????????????????????????????????????????????????

    /// <summary>
    /// Draws a line between two points.
    /// </summary>
    void DrawLine(float x1, float y1, float x2, float y2, Color color, float strokeWidth);

    /// <summary>
    /// Draws a line between two points.
    /// </summary>
    void DrawLine(Vector2 p1, Vector2 p2, Color color, float strokeWidth);

    // ????????????????????????????????????????????????????????????????????
    // RECTANGLE DRAWING
    // ????????????????????????????????????????????????????????????????????

    /// <summary>
    /// Draws a rectangle outline.
    /// </summary>
    void DrawRectangle(float x, float y, float width, float height, Color color, float strokeWidth);

    /// <summary>
    /// Draws a rectangle outline.
    /// </summary>
    void DrawRectangle(Rect rect, Color color, float strokeWidth);

    /// <summary>
    /// Fills a rectangle with a solid color.
    /// </summary>
    void FillRectangle(float x, float y, float width, float height, Color color);

    /// <summary>
    /// Fills a rectangle with a solid color.
    /// </summary>
    void FillRectangle(Rect rect, Color color);

    /// <summary>
    /// Draws a rounded rectangle outline.
    /// </summary>
    void DrawRoundedRectangle(Rect rect, float radiusX, float radiusY, Color color, float strokeWidth);

    /// <summary>
    /// Fills a rounded rectangle with a solid color.
    /// </summary>
    void FillRoundedRectangle(Rect rect, float radiusX, float radiusY, Color color);

    // ????????????????????????????????????????????????????????????????????
    // ELLIPSE DRAWING
    // ????????????????????????????????????????????????????????????????????

    /// <summary>
    /// Draws an ellipse outline.
    /// </summary>
    void DrawEllipse(float centerX, float centerY, float radiusX, float radiusY, Color color, float strokeWidth);

    /// <summary>
    /// Fills an ellipse with a solid color.
    /// </summary>
    void FillEllipse(float centerX, float centerY, float radiusX, float radiusY, Color color);

    // ????????????????????????????????????????????????????????????????????
    // IMAGE DRAWING
    // ????????????????????????????????????????????????????????????????????

    /// <summary>
    /// Draws a bitmap/image to the canvas.
    /// </summary>
    /// <param name="bitmap">Platform-specific bitmap (SKBitmap or CanvasBitmap).</param>
    /// <param name="destRect">Destination rectangle on canvas.</param>
    /// <param name="srcRect">Source rectangle from image.</param>
    /// <param name="opacity">Opacity (0.0 to 1.0).</param>
    /// <param name="interpolation">Interpolation mode for scaling.</param>
    void DrawImage(ICanvasBitmap bitmap, Rect destRect, Rect srcRect, float opacity, ImageInterpolation interpolation);

    /// <summary>
    /// Draws a bitmap/image to the canvas with default interpolation.
    /// </summary>
    void DrawImage(ICanvasBitmap bitmap, Rect destRect, Rect srcRect, float opacity);

    /// <summary>
    /// Draws raw BGRA pixel data to the canvas.
    /// </summary>
    void DrawPixels(byte[] pixels, int width, int height, Rect destRect, Rect srcRect, float opacity, ImageInterpolation interpolation);

    // ????????????????????????????????????????????????????????????????????
    // TEXT DRAWING
    // ????????????????????????????????????????????????????????????????????

    /// <summary>
    /// Draws text at the specified position.
    /// </summary>
    void DrawText(string text, float x, float y, Color color, ITextFormat format);

    /// <summary>
    /// Creates a text format/style for drawing text.
    /// </summary>
    ITextFormat CreateTextFormat(string fontFamily, float fontSize, FontWeight fontWeight = FontWeight.Normal);

    /// <summary>
    /// Creates a text layout for measuring text.
    /// </summary>
    ITextLayout CreateTextLayout(string text, ITextFormat format, float maxWidth, float maxHeight);

    // ????????????????????????????????????????????????????????????????????
    // TRANSFORMS & CLIPPING
    // ????????????????????????????????????????????????????????????????????

    /// <summary>
    /// Gets or sets the current transform matrix.
    /// </summary>
    Matrix3x2 Transform { get; set; }

    /// <summary>
    /// Pushes a clipping rectangle onto the clip stack.
    /// </summary>
    void PushClip(Rect clipRect);

    /// <summary>
    /// Pops the most recent clipping rectangle from the clip stack.
    /// </summary>
    void PopClip();

    /// <summary>
    /// Creates a layer with the specified opacity and optional clip rect.
    /// Returns a disposable that pops the layer when disposed.
    /// </summary>
    IDisposable CreateLayer(float opacity, Rect? clipRect = null);

    // ????????????????????????????????????????????????????????????????????
    // ANTIALIASING
    // ????????????????????????????????????????????????????????????????????

    /// <summary>
    /// Gets or sets the antialiasing mode.
    /// </summary>
    bool Antialiasing { get; set; }

    // ????????????????????????????????????????????????????????????????????
    // PATTERN/BRUSH FILLS
    // ????????????????????????????????????????????????????????????????????

    /// <summary>
    /// Fills a rectangle with a tiled pattern/brush.
    /// </summary>
    void FillRectangleWithBrush(Rect rect, ICanvasBrush brush);

    /// <summary>
    /// Creates a tiled image brush from a bitmap.
    /// </summary>
    ICanvasBrush CreateTiledImageBrush(ICanvasBitmap bitmap);
}

/// <summary>
/// Platform-agnostic bitmap interface.
/// </summary>
public interface ICanvasBitmap : IDisposable
{
    int Width { get; }
    int Height { get; }
    object NativeBitmap { get; }
}

/// <summary>
/// Platform-agnostic text format interface.
/// </summary>
public interface ITextFormat : IDisposable
{
    string FontFamily { get; }
    float FontSize { get; }
    FontWeight FontWeight { get; }
    object NativeFormat { get; }
}

/// <summary>
/// Platform-agnostic text layout interface for measuring.
/// </summary>
public interface ITextLayout : IDisposable
{
    float LayoutWidth { get; }
    float LayoutHeight { get; }
    Rect LayoutBounds { get; }
}

/// <summary>
/// Platform-agnostic brush interface.
/// </summary>
public interface ICanvasBrush : IDisposable
{
    Matrix3x2 Transform { get; set; }
    object NativeBrush { get; }
}

/// <summary>
/// Image interpolation modes for scaling.
/// </summary>
public enum ImageInterpolation
{
    /// <summary>Nearest-neighbor (pixelated) interpolation.</summary>
    NearestNeighbor,
    /// <summary>Linear interpolation.</summary>
    Linear,
    /// <summary>High-quality cubic interpolation.</summary>
    HighQualityCubic
}

/// <summary>
/// Font weight values.
/// </summary>
public enum FontWeight
{
    Thin = 100,
    ExtraLight = 200,
    Light = 300,
    Normal = 400,
    Medium = 500,
    SemiBold = 600,
    Bold = 700,
    ExtraBold = 800,
    Black = 900
}
