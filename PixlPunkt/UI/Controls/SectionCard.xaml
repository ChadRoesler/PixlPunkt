<UserControl
    x:Class="PixlPunkt.UI.Controls.SectionCard"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ic="using:FluentIcons.WinUI"
    xmlns:conv="using:PixlPunkt.UI.Converters"
    x:Name="root"
    HorizontalAlignment="Stretch"
    VerticalAlignment="Stretch"
    HorizontalContentAlignment="Stretch"
    VerticalContentAlignment="Stretch">

    <UserControl.Resources>
        <conv:BoolToVisibilityConverter x:Key="BoolToVis"/>
        <conv:InverseBoolToVisibilityConverter x:Key="NotBoolToVis"/>
    </UserControl.Resources>

    <Border Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}" 
            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
            BorderThickness="1"
            CornerRadius="8" 
            Padding="4"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch">
        <Grid HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <!-- header -->
                <RowDefinition Height="Auto"/>
                <!-- spacer (hidden when minimized) -->
                <RowDefinition Height="*"/>
                <!-- body -->
            </Grid.RowDefinitions>

            <!-- Header -->
            <Grid Grid.Row="0" Padding="0" HorizontalAlignment="Stretch">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal" x:Name="TitleBarRow">
                    <ic:FluentIcon
                        x:Name="HeaderIcon"
                        Icon="Edit"
                        FontSize="16"
                        VerticalAlignment="Center"
                        Margin="6"/>
                    <TextBlock
                        Text="{Binding Title, ElementName=root, Mode=OneWay}"
                        FontSize="16"
                        VerticalAlignment="Center"
                        />
                </StackPanel>

                <!-- Actions slot (user-provided) - hidden when minimized -->
                <ContentPresenter
                    Grid.Column="1"
                    Content="{Binding Actions, ElementName=root, Mode=OneWay}"
                    VerticalAlignment="Center"
                    Margin="8,0,0,0"
                    Visibility="{Binding IsMinimized, ElementName=root, Mode=OneWay, Converter={StaticResource NotBoolToVis}}"/>

                <!-- Undock/Dock button -->
                <Button
                    Grid.Column="2"
                    x:Name="UndockButton"
                    Click="UndockButton_Click"
                    Background="Transparent"
                    Visibility="{Binding CanUndock, ElementName=root, Mode=OneWay, Converter={StaticResource BoolToVis}}"
                    ToolTipService.ToolTip="Undock to separate window">
                    <ic:FluentIcon
                        x:Name="UndockButtonIcon"
                        Icon="Open"
                        FontSize="16"
                        VerticalAlignment="Center"/>
                </Button>

                <!-- Collapse/Expand button -->
                <Button
                    Grid.Column="3"
                    x:Name="MinToggle"
                    Click="MinToggle_Click"
                    Background="Transparent"
                    ToolTipService.ToolTip="Collapse/Expand">
                    <ic:FluentIcon
                        x:Name="MinToggleIcon"
                        Icon="ArrowMinimizeVertical"
                        FontSize="16"
                        VerticalAlignment="Center"/>
                </Button>
            </Grid>

            <!-- Spacer (hidden when minimized) -->
            <Border Grid.Row="1" Height="4"
                    Visibility="{Binding IsMinimized, ElementName=root, Mode=OneWay, Converter={StaticResource NotBoolToVis}}"/>

            <!-- Body (hidden when minimized) -->
            <ContentPresenter
                Grid.Row="2"
                Content="{Binding Body, ElementName=root, Mode=OneWay}"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                HorizontalContentAlignment="Stretch"
                VerticalContentAlignment="Stretch"
                Visibility="{Binding IsMinimized, ElementName=root, Mode=OneWay, Converter={StaticResource NotBoolToVis}}"/>

            <ContentPresenter
                Grid.Row="2"
                Content="{Binding CustomControl, ElementName=root, Mode=OneWay}"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                HorizontalContentAlignment="Stretch"
                VerticalContentAlignment="Stretch"
                Visibility="{Binding IsMinimized, ElementName=root, Mode=OneWay, Converter={StaticResource NotBoolToVis}}"/>
        </Grid>
    </Border>
</UserControl>
