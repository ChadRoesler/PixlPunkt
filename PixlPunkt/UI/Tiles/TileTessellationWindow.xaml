<!--
═══════════════════════════════════════════════════════════════════════════════
  TILE TESSELLATION WINDOW - Tile Pattern Preview & Editing
═══════════════════════════════════════════════════════════════════════════════
  Shows a tessellated preview of a tile in a grid pattern to visualize
  how it will repeat. Allows editing tile content with wrap-around preview.
  
  Features:
    • 3x3 (or larger) tessellated preview of the tile
    • Grid overlay toggle to show tile boundaries
    • Interactive editing with wrap-around visualization
    • Offset sliders for pixel-level adjustment
    • Export tile changes back to tile set
═══════════════════════════════════════════════════════════════════════════════
-->
<Window
    x:Class="PixlPunkt.UI.Tiles.TileTessellationWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ic="using:FluentIcons.WinUI"
    xmlns:win2d="using:Microsoft.Graphics.Canvas.UI.Xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="Tile Tessellator">

    <Grid Background="{ThemeResource SolidBackgroundFillColorBaseBrush}" Padding="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Toolbar -->
            <RowDefinition Height="*"/>
            <!-- Preview Area -->
            <RowDefinition Height="Auto"/>
            <!-- Offset Controls -->
            <RowDefinition Height="Auto"/>
            <!-- Footer -->
        </Grid.RowDefinitions>

        <!-- ═══════════════════════════════════════════════════════════════ -->
        <!-- TOOLBAR -->
        <!-- ═══════════════════════════════════════════════════════════════ -->
        <StackPanel 
            Grid.Row="0" 
            Orientation="Horizontal" 
            Spacing="8"
            Margin="0,0,0,8">
            
            <!-- Grid Size -->
            <TextBlock Text="Grid:" VerticalAlignment="Center"/>
            <ComboBox 
                x:Name="GridSizeCombo"
                SelectedIndex="1"
                SelectionChanged="GridSizeCombo_SelectionChanged"
                MinWidth="80">
                <ComboBoxItem Content="2x2"/>
                <ComboBoxItem Content="3x3"/>
                <ComboBoxItem Content="4x4"/>
                <ComboBoxItem Content="5x5"/>
            </ComboBox>

            <!-- Separator -->
            <Border Width="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}" Margin="8,4"/>

            <!-- Show Grid Toggle -->
            <ToggleButton 
                x:Name="ShowGridToggle"
                IsChecked="True"
                ToolTipService.ToolTip="Show tile grid"
                Checked="ShowGridToggle_Changed"
                Unchecked="ShowGridToggle_Changed"
                Padding="6">
                <ic:FluentIcon Icon="Grid" FontSize="16"/>
            </ToggleButton>

            <!-- Zoom -->
            <TextBlock Text="Zoom:" VerticalAlignment="Center" Margin="8,0,0,0"/>
            <Slider 
                x:Name="ZoomSlider"
                Minimum="1"
                Maximum="8"
                StepFrequency="1"
                TickFrequency="1"
                SnapsTo="Ticks"
                Value="2"
                Width="120"
                ValueChanged="ZoomSlider_ValueChanged"/>
            <TextBlock 
                x:Name="ZoomLabel" 
                Text="2x" 
                VerticalAlignment="Center"
                MinWidth="30"/>
        </StackPanel>

        <!-- ═══════════════════════════════════════════════════════════════ -->
        <!-- TESSELLATION PREVIEW -->
        <!-- ═══════════════════════════════════════════════════════════════ -->
        <Border 
            Grid.Row="1"
            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
            BorderThickness="1"
            CornerRadius="8"
            MinHeight="200"
            MinWidth="200">
            
            <ScrollViewer
                x:Name="PreviewScroller"
                HorizontalScrollBarVisibility="Auto"
                VerticalScrollBarVisibility="Auto"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch">
                
                <!-- Win2D Canvas for proper rendering -->
                <win2d:CanvasControl 
                    x:Name="TessellationCanvas"
                    Draw="TessellationCanvas_Draw"
                    PointerPressed="TessellationCanvas_PointerPressed"
                    PointerMoved="TessellationCanvas_PointerMoved"
                    PointerReleased="TessellationCanvas_PointerReleased"
                    PointerExited="TessellationCanvas_PointerExited"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"/>
            </ScrollViewer>
        </Border>

        <!-- ═══════════════════════════════════════════════════════════════ -->
        <!-- OFFSET CONTROLS -->
        <!-- ═══════════════════════════════════════════════════════════════ -->
        <Grid 
            Grid.Row="2" 
            Margin="0,12,0,0"
            ColumnSpacing="16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- X Offset -->
            <StackPanel Grid.Column="0" Spacing="4">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="X Offset:" VerticalAlignment="Center"/>
                    <NumberBox 
                        x:Name="OffsetXBox"
                        Value="0"
                        SpinButtonPlacementMode="Compact"
                        SmallChange="1"
                        MinWidth="80"
                        ValueChanged="OffsetXBox_ValueChanged"/>
                </StackPanel>
                <Slider 
                    x:Name="OffsetXSlider"
                    Minimum="0"
                    Value="0"
                    ValueChanged="OffsetXSlider_ValueChanged"/>
            </StackPanel>

            <!-- Y Offset -->
            <StackPanel Grid.Column="1" Spacing="4">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="Y Offset:" VerticalAlignment="Center"/>
                    <NumberBox 
                        x:Name="OffsetYBox"
                        Value="0"
                        SpinButtonPlacementMode="Compact"
                        SmallChange="1"
                        MinWidth="80"
                        ValueChanged="OffsetYBox_ValueChanged"/>
                </StackPanel>
                <Slider 
                    x:Name="OffsetYSlider"
                    Minimum="0"
                    Value="0"
                    ValueChanged="OffsetYSlider_ValueChanged"/>
            </StackPanel>
        </Grid>

        <!-- ═══════════════════════════════════════════════════════════════ -->
        <!-- FOOTER -->
        <!-- ═══════════════════════════════════════════════════════════════ -->
        <StackPanel 
            Grid.Row="3" 
            Orientation="Horizontal" 
            HorizontalAlignment="Right" 
            Spacing="8"
            Margin="0,12,0,0">
            
            <Button 
                x:Name="ResetBtn"
                Content="Reset"
                Click="ResetBtn_Click"
                ToolTipService.ToolTip="Reset offset to 0,0"/>
            
            <Button 
                x:Name="ApplyBtn"
                Content="Apply Offset"
                Click="ApplyBtn_Click"
                Style="{ThemeResource AccentButtonStyle}"
                ToolTipService.ToolTip="Apply offset to tile permanently"/>
            
            <Button 
                Content="Close" 
                Click="CloseBtn_Click"/>
        </StackPanel>
    </Grid>
</Window>
