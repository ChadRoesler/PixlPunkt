<!--
═══════════════════════════════════════════════════════════════════════════════
  COLOR PICKER WINDOW - HSL Color Selection & Ladder Management
═══════════════════════════════════════════════════════════════════════════════
  Comprehensive color picker featuring HSL color space manipulation with
  interactive Win2D canvases and color variation ladders.
  
  Layout Structure:
    Left Column:  HSL saturation/lightness square + hue bar (Win2D canvases)
    Right Column: Value inputs (HSL/RGB/Hex/Alpha) + Color ladders
  
  Features:
    • HSL canvas for saturation/lightness picking (240x240)
    • Hue canvas for hue selection (240x18)
    • Dual value input (HSL and RGB number boxes)
    • Alpha channel slider + number box
    • Hex color input (#RRGGBB or #AARRGGBB)
    • Color ladders: Shade, Tint, Hue, Tone variations
    • Old/New color comparison swatches
    • Live updates via pointer events and canvas drawing
    • Global color dropper button for picking from canvas
═══════════════════════════════════════════════════════════════════════════════
-->
<Window
    x:Class="PixlPunkt.UI.ColorPick.ColorPickerWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:win2d="using:Microsoft.Graphics.Canvas.UI.Xaml"
    xmlns:conv="using:PixlPunkt.UI.Converters"
    xmlns:cp="using:PixlPunkt.UI.ColorPick.Controls"
    xmlns:ic="using:FluentIcons.WinUI">

    <Grid 
        Background="{ThemeResource SolidBackgroundFillColorBaseBrush}" 
        Padding="16">

        <!-- ═══════════════════════════════════════════════════════════════ -->
        <!-- RESOURCES -->
        <!-- ═══════════════════════════════════════════════════════════════ -->
        <Grid.Resources>

            <!-- Horizontal layout template for swatch ladders -->
            <ItemsPanelTemplate x:Key="HorizontalItemsPanelTemplate">
                <ItemsStackPanel Orientation="Horizontal"/>
            </ItemsPanelTemplate>

            <!-- Converts BGRA uint to WinUI Brush for swatch display -->
            <conv:BgraToBrushConverter x:Key="BgraToBrush"/>

            <!-- Converts boolean to Visibility for conditional rendering -->
            <conv:BoolToVisibilityConverter x:Key="BoolToVis"/>

            <!-- ─────────────────────────────────────────────────────────── -->
            <!-- COMPACT CONTROL STYLES -->
            <!-- Consistent sizing for all input controls -->
            <!-- ─────────────────────────────────────────────────────────── -->

            <!-- Number Box: Uniform sizing for HSL/RGB inputs -->
            <Style TargetType="NumberBox">
                <Setter Property="MinWidth" Value="84"/>
                <Setter Property="Height" Value="32"/>
                <Setter Property="CornerRadius" Value="6"/>
                <Setter Property="Padding" Value="8,6"/>
            </Style>

            <!-- Text Box: Hex color input styling -->
            <Style TargetType="TextBox">
                <Setter Property="MinWidth" Value="220"/>
                <Setter Property="CornerRadius" Value="6"/>
                <Setter Property="Padding" Value="8,6"/>
            </Style>

            <!-- Slider: Compact height for alpha control -->
            <Style TargetType="Slider">
                <Setter Property="Height" Value="20"/>
            </Style>

        </Grid.Resources>

        <!-- ═══════════════════════════════════════════════════════════════ -->
        <!-- GRID LAYOUT DEFINITION -->
        <!-- Row 0: Main content | Row 1: Footer buttons -->
        <!-- ═══════════════════════════════════════════════════════════════ -->
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Main content row -->
            <RowDefinition Height="Auto"/>
            <!-- Footer button row -->
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <!-- Left: HSL canvases -->
            <ColumnDefinition Width="16"/>
            <!-- Spacing gap -->
            <ColumnDefinition Width="*"/>
            <!-- Right: Values + ladders -->
        </Grid.ColumnDefinitions>

        <!-- ═══════════════════════════════════════════════════════════════ -->
        <!-- LEFT COLUMN: WIN2D CANVAS CONTROLS -->
        <!-- Interactive color selection via Win2D canvases -->
        <!-- ═══════════════════════════════════════════════════════════════ -->
        <StackPanel 
            Grid.Row="0" 
            Grid.Column="0" 
            Spacing="8">

            <!-- HSL Saturation/Lightness Canvas (240x240) -->
            <!-- Win2D canvas with custom gradient rendering and pointer interaction -->
            <cp:HslSquare x:Name="HslSquare"
              Width="240"
              Height="240"
              SVChanging="HslSquare_SVChanging"
              SVChanged="HslSquare_SVChanged"/>

            <!-- New Hue Slider Control -->
            <cp:HueSlider x:Name="HueSlider"
                                 Width="240"
                                 Height="18"
                                 HueChanged="HueSlider_HueChanged"
                                 HueChanging="HueSlider_HueChanging"/>
        </StackPanel>

        <!-- ═══════════════════════════════════════════════════════════════ -->
        <!-- RIGHT COLUMN: VALUES & LADDERS -->
        <!-- Two-column layout: input controls + color variation ladders -->
        <!-- ═══════════════════════════════════════════════════════════════ -->
        <Grid 
            Grid.Row="0" 
            Grid.Column="2" 
            ColumnSpacing="16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="230"/>
                <!-- Compact values column -->
                <ColumnDefinition Width="320"/>
                <!-- Wider ladders column -->
            </Grid.ColumnDefinitions>

            <!-- ─────────────────────────────────────────────────────────── -->
            <!-- VALUES COLUMN: Input Controls -->
            <!-- ─────────────────────────────────────────────────────────── -->
            <StackPanel 
                Grid.Column="0" 
                Spacing="8">

                <!-- Old/New Color Comparison Swatches with Dropper Button -->
                <StackPanel 
                    Orientation="Horizontal" 
                    Spacing="8" 
                    Margin="0,0,0,4">
                    <TextBlock 
                        Text="Old" 
                        Opacity="0.7" 
                        VerticalAlignment="Center"/>
                    <Border 
                        Width="44" 
                        Height="24" 
                        CornerRadius="6"              
                        Background="{x:Bind OldBrush}"/>

                    <TextBlock 
                        Text="New" 
                        Margin="12,0,0,0" 
                        Opacity="0.7" 
                        VerticalAlignment="Center"/>
                    <Border 
                        Width="44" 
                        Height="24" 
                        CornerRadius="6" 
                        BorderBrush="White" 
                        BorderThickness="2"
                        Background="{x:Bind NewBrush}"/>

                    <!-- Global Color Dropper Button -->
                    <ToggleButton 
                        x:Name="DropperButton"
                        Margin="12,0,0,0"
                        Padding="6"
                        ToolTipService.ToolTip="Pick color from canvas (click to activate, then click on canvas)"
                        Checked="DropperButton_Checked"
                        Unchecked="DropperButton_Unchecked">
                        <ic:FluentIcon Icon="Syringe" FontSize="16"/>
                    </ToggleButton>
                </StackPanel>

                <!-- HSL & RGB Input Grid (3x5 layout) -->
                <Grid 
                    ColumnSpacing="8" 
                    RowSpacing="6">
                    <Grid.RowDefinitions>
                        <RowDefinition/>
                        <!-- H / R -->
                        <RowDefinition/>
                        <!-- S / G -->
                        <RowDefinition/>
                        <!-- L / B -->
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <!-- HSL label -->
                        <ColumnDefinition Width="*"/>
                        <!-- HSL value -->
                        <ColumnDefinition Width="8"/>
                        <!-- Gap -->
                        <ColumnDefinition Width="Auto"/>
                        <!-- RGB label -->
                        <ColumnDefinition Width="*"/>
                        <!-- RGB value -->
                    </Grid.ColumnDefinitions>

                    <!-- Row 0: Hue (0-359) / Red (0-255) -->
                    <TextBlock 
                        Text="H" 
                        Grid.Row="0" 
                        Grid.Column="0" 
                        VerticalAlignment="Center"/>
                    <NumberBox 
                        x:Name="HBox" 
                        Grid.Row="0" 
                        Grid.Column="1"
                        Minimum="0" 
                        Maximum="359" 
                        SmallChange="1"
                        ValueChanged="HBox_ValueChanged"/>

                    <TextBlock 
                        Text="R" 
                        Grid.Row="0" 
                        Grid.Column="3" 
                        VerticalAlignment="Center"/>
                    <NumberBox 
                        x:Name="RBox" 
                        Grid.Row="0" 
                        Grid.Column="4"
                        Minimum="0" 
                        Maximum="255" 
                        SmallChange="1"
                        ValueChanged="RBox_ValueChanged"/>

                    <!-- Row 1: Saturation (0-99) / Green (0-255) -->
                    <TextBlock 
                        Text="S" 
                        Grid.Row="1" 
                        Grid.Column="0" 
                        VerticalAlignment="Center"/>
                    <NumberBox 
                        x:Name="SBoxInt" 
                        Grid.Row="1" 
                        Grid.Column="1"
                        Minimum="0" 
                        Maximum="99" 
                        SmallChange="1"
                        ValueChanged="SBoxInt_ValueChanged"/>

                    <TextBlock 
                        Text="G" 
                        Grid.Row="1" 
                        Grid.Column="3" 
                        VerticalAlignment="Center"/>
                    <NumberBox 
                        x:Name="GBox" 
                        Grid.Row="1" 
                        Grid.Column="4"
                        Minimum="0" 
                        Maximum="255" 
                        SmallChange="1"
                        ValueChanged="GBox_ValueChanged"/>

                    <!-- Row 2: Lightness (0-99) / Blue (0-255) -->
                    <TextBlock 
                        Text="L" 
                        Grid.Row="2" 
                        Grid.Column="0" 
                        VerticalAlignment="Center"/>
                    <NumberBox 
                        x:Name="LBoxInt" 
                        Grid.Row="2" 
                        Grid.Column="1"
                        Minimum="0" 
                        Maximum="99" 
                        SmallChange="1"
                        ValueChanged="LBoxInt_ValueChanged"/>

                    <TextBlock 
                        Text="B" 
                        Grid.Row="2" 
                        Grid.Column="3" 
                        VerticalAlignment="Center"/>
                    <NumberBox 
                        x:Name="BBox" 
                        Grid.Row="2" 
                        Grid.Column="4"
                        Minimum="0" 
                        Maximum="255" 
                        SmallChange="1"
                        ValueChanged="BBox_ValueChanged"/>
                </Grid>

                <!-- Alpha Controls: Slider + Number Box -->
                <!-- Positioned lower to avoid collision with slider thumb -->
                <Grid 
                    ColumnSpacing="8" 
                    Margin="0,6,0,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <!-- Label + numeric -->
                        <RowDefinition Height="Auto"/>
                        <!-- Slider -->
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <!-- Slider column -->
                        <ColumnDefinition Width="*"/>
                        <!-- Numeric column -->
                    </Grid.ColumnDefinitions>

                    <!-- Alpha Label + Number Box -->
                    <TextBlock 
                        Text="Alpha" 
                        Grid.Row="0" 
                        Grid.Column="0" 
                        Margin="0,0,0,4" 
                        VerticalAlignment="Center"/>
                    <NumberBox 
                        x:Name="AlphaBox" 
                        Grid.Row="0" 
                        Grid.Column="1"
                        Minimum="0" 
                        Maximum="255"
                        ValueChanged="AlphaBox_ValueChanged"/>

                    <!-- Alpha Slider (full width, positioned below) -->
                    <Slider 
                        x:Name="AlphaSlider" 
                        Grid.Row="1" 
                        Grid.ColumnSpan="2"
                        Minimum="0" 
                        Maximum="255"
                        HorizontalAlignment="Stretch"
                        Height="30"
                        Margin="0,0,0,0"
                        VerticalAlignment="Center"
                        ValueChanged="AlphaSlider_ValueChanged"/>
                </Grid>

                <!-- Hex Color Input (positioned lower to avoid alpha slider) -->
                <TextBlock 
                    Text="Hex (#RRGGBB or #AARRGGBB)" 
                    Margin="0,10,0,0"/>
                <TextBox 
                    x:Name="HexBox" 
                    TextChanged="HexBox_TextChanged"/>
            </StackPanel>

            <!-- ─────────────────────────────────────────────────────────── -->
            <!-- LADDERS COLUMN: Color Variation Swatches -->
            <!-- Four ladder rows showing color relationships -->
            <!-- ─────────────────────────────────────────────────────────── -->
            <StackPanel 
                Grid.Column="1" 
                Spacing="6" 
                HorizontalAlignment="Stretch">

                <!-- Shade Ladder: Darker variations (reduced lightness) -->
                <TextBlock 
                    Text="Shade" 
                    Opacity="0.7"/>
                <cp:LadderRow x:Name="ShadeRow"/>

                <!-- Tint Ladder: Lighter variations (increased lightness) -->
                <TextBlock 
                    Text="Tint" 
                    Opacity="0.7" 
                    Margin="0,6,0,0"/>
                <cp:LadderRow x:Name="TintRow"/>

                <!-- Hue Ladder: Hue shifts around color wheel -->
                <TextBlock 
                    Text="Hue" 
                    Opacity="0.7" 
                    Margin="0,6,0,0"/>
                <cp:LadderRow x:Name="HueRow"/>

                <!-- Tone Ladder: Saturation variations -->
                <TextBlock 
                    Text="Tone" 
                    Opacity="0.7" 
                    Margin="0,6,0,0"/>
                <cp:LadderRow x:Name="ToneRow"/>
            </StackPanel>

        </Grid>

        <!-- ═══════════════════════════════════════════════════════════════ -->
        <!-- FOOTER: Action Buttons -->
        <!-- ═══════════════════════════════════════════════════════════════ -->
        <StackPanel 
            Grid.Row="1" 
            Grid.ColumnSpan="3"
            Orientation="Horizontal" 
            HorizontalAlignment="Right" 
            Spacing="8">
            <Button 
                Content="Okay" 
                Click="Okay_Click"/>
            <Button 
                Content="Close" 
                Click="Close_Click"/>
        </StackPanel>

    </Grid>
</Window>