using System.Text.Json.Serialization;

namespace PixlPunkt.Core.Settings
{
    /// <summary>
    /// Image export format options.
    /// </summary>
    public enum ExportImageFormat
    {
        Png = 0,
        Bmp = 1,
        Jpeg = 2,
        Tiff = 3,
        Gif = 4
    }

    /// <summary>
    /// Animation export format options.
    /// </summary>
    public enum ExportAnimationFormat
    {
        Gif = 0,
        PngSequence = 1,
        SpriteSheet = 2
    }

    /// <summary>
    /// Sprite sheet layout direction options.
    /// </summary>
    public enum SpriteSheetDirection
    {
        Horizontal = 0,
        Vertical = 1,
        Grid = 2
    }

    /// <summary>
    /// Sequence numbering style for exported file sequences.
    /// </summary>
    public enum SequenceNumberingStyle
    {
        /// <summary>_0, _1, _2...</summary>
        Simple = 0,
        /// <summary>_001, _002, _003...</summary>
        ThreeDigit = 1,
        /// <summary>_0001, _0002...</summary>
        FourDigit = 2,
        /// <summary>(1), (2), (3)...</summary>
        Parentheses = 3
    }

    /// <summary>
    /// Settings for export defaults persisted across sessions.
    /// </summary>
    public sealed class ExportSettings
    {
        // ????????????????????????????????????????????????????????????????
        // IMAGE EXPORT DEFAULTS
        // ????????????????????????????????????????????????????????????????

        /// <summary>Default image export format (PNG recommended for pixel art).</summary>
        public ExportImageFormat DefaultImageFormat { get; set; } = ExportImageFormat.Png;

        /// <summary>Default image export scale multiplier (1 = original size).</summary>
        public int DefaultImageScale { get; set; } = 1;

        /// <summary>Whether to include background color in exports by default.</summary>
        public bool IncludeBackground { get; set; } = false;

        // ????????????????????????????????????????????????????????????????
        // ANIMATION EXPORT DEFAULTS
        // ????????????????????????????????????????????????????????????????

        /// <summary>Default animation export format.</summary>
        public ExportAnimationFormat DefaultAnimationFormat { get; set; } = ExportAnimationFormat.Gif;

        /// <summary>Default animation export scale multiplier.</summary>
        public int DefaultAnimationScale { get; set; } = 1;

        /// <summary>Whether exported animations should loop by default.</summary>
        public bool LoopAnimation { get; set; } = true;

        // ????????????????????????????????????????????????????????????????
        // SPRITE SHEET OPTIONS
        // ????????????????????????????????????????????????????????????????

        /// <summary>Default sprite sheet layout direction.</summary>
        public SpriteSheetDirection SpriteSheetDirection { get; set; } = SpriteSheetDirection.Horizontal;

        /// <summary>Number of columns for grid layout sprite sheets.</summary>
        public int SpriteSheetColumns { get; set; } = 8;

        /// <summary>Padding between frames in sprite sheets (pixels).</summary>
        public int SpriteSheetPadding { get; set; } = 0;

        // ????????????????????????????????????????????????????????????????
        // FILE NAMING
        // ????????????????????????????????????????????????????????????????

        /// <summary>Numbering style for sequence exports.</summary>
        public SequenceNumberingStyle SequenceNumbering { get; set; } = SequenceNumberingStyle.ThreeDigit;

        /// <summary>Whether to remember the last export folder.</summary>
        public bool RememberLastFolder { get; set; } = true;

        /// <summary>Last used export folder path (not shown in UI, just remembered).</summary>
        [JsonIgnore]
        public string? LastExportFolder { get; set; }

        // ????????????????????????????????????????????????????????????????
        // VALIDATION
        // ????????????????????????????????????????????????????????????????

        /// <summary>
        /// Validates and clamps settings to valid ranges.
        /// </summary>
        public void Validate()
        {
            // Clamp image scale
            if (DefaultImageScale < 1) DefaultImageScale = 1;
            if (DefaultImageScale > 16) DefaultImageScale = 16;

            // Clamp animation scale
            if (DefaultAnimationScale < 1) DefaultAnimationScale = 1;
            if (DefaultAnimationScale > 8) DefaultAnimationScale = 8;

            // Clamp sprite sheet options
            if (SpriteSheetColumns < 1) SpriteSheetColumns = 1;
            if (SpriteSheetColumns > 64) SpriteSheetColumns = 64;
            if (SpriteSheetPadding < 0) SpriteSheetPadding = 0;
            if (SpriteSheetPadding > 32) SpriteSheetPadding = 32;
        }
    }
}
